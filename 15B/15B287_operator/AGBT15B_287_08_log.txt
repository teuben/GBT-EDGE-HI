 
 
#######################################################
 SCRIPT NUMBER 1, project:AGBT15B_287_08 
 177512 128 OPERATOR 3 Dave Curry 2015-12-01 21:41:20 obs_aborted 
#######################################################
# test script to update catalog as you go...

########## CHANGE THESE ONLY #############
OnOffOnTime = 21 #minutes (change this to 12 to be in line with DSS scheduling)
obs_per_source = 3 #total observing time per source = OnOffOnTime * obs_per_source
h = Horizon(10.0) #minimum of 10 degrees elevation
myOff = Offset("J2000",1.0,0.0,cosv=True)  # Off position relative to source
doFirstPointing = True #Setting to False will skip the first pointing
doFirstCal = True  #Setting to False will skip the first 3C calibrator OnOff scan
peak_every = 6 #peak/cal every 6 OnOffOn (every 2.5 hours) 12 if changed
peak_near_source = False #Do another peak when changing to new source
#####################################

######### NOTES ###############
# This script runs in blocks of On-Off-On position switching with
# the two outer 'on' scans sharing one 'off'
# Total on-source time = 42 minutes   (24 if changes)
# Length of one 'On' or 'Off' = 7 minutes   (4 minutes if changes)
# Length of one On-Off-On = 21 minutes (14 minutes on-source)    (12 min if changes)
# 3 On-Off-On blocks are needed per source (63 minutes altogether)  (36 minutes if changes)
# !!!! Please remember to update catalog after session is complete

###### Timing
# It takes 1h 8m to completely observe 1 source+overhead (9 track scans)

execfile("/home/astro-util/projects/15B287_operator/15B287_config.py")
execfile("/home/astro-util/projects/15B287_operator/15B287_utils.py")
Catalog(fluxcal)
Catalog(lband_pointing)

scanTime = OnOffOnTime * 20.0 #seconds
tdelta = DateTime.TimeDelta(minutes=OnOffOnTime)
obs_count = 0
doCal = doFirstCal
doPointing = doFirstPointing
project_obs = 0
old_catalog_name = 'dummy'

Configure(config_1)

while project_obs < 10:
    mycat,altcal = select_my_catalog()
    if mycat == old_catalog_name:
        print 'SAME CATALOG HAS BEEN SELECTED: Using FULL catalog'
        mycat = '/home/astro-util/projects/15B287_operator/15B287_operator.cat'
        altcal = '3C309_1'
    old_catalog_name = mycat
    c = Catalog(mycat)
    sources = c.keys()
    for source in sources:
        doBalance = True
        newPeak = True
        calibrator = c[source]["calibrator"]
        n_obs = int(float(c[source]["n_obs"]))
        obs_left = obs_per_source-n_obs
        obs_ok = obs_left > 0
        t_now = Now()
        if t_now != None and obs_ok:
            source_rise = h.GetRise(source)
            source_set  = h.GetSet(source)
            if source_rise != None:
                if source_set != None:
                    t_ok = ((t_now + tdelta) < source_set)
                    t_ok = t_ok and (t_now >= source_rise)
                else:
                    t_ok = True
            else:
                t_ok = False
        else:
            t_ok = False

        source_ok = t_ok and obs_ok

        if source_ok:
            if doPointing == True:
                #check the calibrator is above the horizon
                if h.GetRise(calibrator)>t_now:
                    myCal = altCal #circumpolar alternative
                    print 'Calibrator %s is too low: Using %s' %(calibrator,altCal)
                else:
                    myCal = calibrator
                if obs_count == 0:
                    AutoPeakFocus(myCal)
                    #Break("Check Peak and Focus")
                else:
                    AutoPeak(myCal)
                Configure(config_1)
                doBalance = True
                doPointing = False

            if doCal:
                Slew(myCal)
                Balance()
                print 'Calibration scans (OnOff) :%s ' %(myCal)
                OnOff(myCal,myOff,120.0)
                doCal = False
                doBalance = True

            for i in range(obs_left):
                t_now = Now()   #check time ok again
                t_ok = False
                if t_now != None:
                    if source_rise != None:
                        if source_set != None:
                            t_ok = ((t_now + tdelta) < source_set)
                            t_ok = t_ok and (t_now >= source_rise)
                        else:
                            t_ok = True
                    else:
                        t_ok = False
                else:
                    t_ok = False

                if t_ok:
                    if peak_near_source and newPeak:
                        Slew(source)
                        AutoPeak()
                        Configure(config_1)
                        newPeak = False
                        doBalance = True
                    if doBalance:
                        Slew(source)
                        Balance()
                        doBalance = False

                    Comment("Starting on-source scan")
                    Track(source,None,scanTime)
                    Comment("Starting off-source scan")
                    Track(source,None,scanTime,fixedOffset=myOff)
                    Comment("Starting on-source scan")
                    Track(source,None,scanTime)
                    obs_count = obs_count + 1
                    obs_tot = obs_per_source+1-obs_left+i
                    print '%s: OBS COMPLETE = %s/%s' %(source,obs_tot,obs_per_source)
                    update_my_catalogs(source,obs_tot)

                    if obs_count % peak_every == 0:  #Cal/pointing interval
                        doCal = True
                        doPointing = True
    project_obs = project_obs+1
#######################################################
 LOG SESSION NUMBER 1 
[21:41:20] Field 'log' doesn't have a default value
[21:41:20] ******** Begin Scheduling Block
[21:41:20] ******** observer = OPERATOR, SB name = 15B287_operator_test, project ID = AGBT15B_287, date = 01 Dec 2015

[21:41:20] Configuring telescope.
[21:41:38]     Setting State: Activating
[21:41:39]     Setting State: Ready
[21:41:40] Default values are
[21:41:40] if3freq  =  [0, 0, 0]
[21:41:40] notchfilter  =  In
[21:41:40] polswitch  =  thru
[21:41:40] The bad devices are: 
[21:41:40] OpticalDriver5
[21:41:40] The bad devices are: 
[21:41:40] OpticalDriver5
[21:41:40] WARNING: Frequencies adjusted to the local frame and velocities fall within the notch filter limits
[21:41:40] Frequency =  1345.0
[21:41:40] Frequency =  1345.0
[21:41:40] Frequency =  1345.0
[21:41:40] Frequency =  1345.0
[21:41:40] Waiting for the ScanCoordinator to finish activating
[21:41:40] . . .
[21:41:40] Checking telescope
[21:41:40] Configuration Complete
[21:41:40] Selecting Catalog
[21:41:40] Using Catalog for LST 17-21
[21:41:40] Configuring telescope.
[21:41:41]     Setting State: Activating
[21:41:42]     Setting State: Ready
[21:41:42]     Setting State: Activating
[21:41:43] Default values are
[21:41:43] if3freq  =  [0]
[21:41:43] notchfilter  =  In
[21:41:43] polswitch  =  thru
[21:41:43] The bad devices are: 
[21:41:43] OpticalDriver5

[21:41:43] Checking telescope
[21:41:43] Configuration Complete
[21:41:43]     Setting State: Ready
[21:41:43] source : 3C295
               F1 : 0.4
               F2 : 32.0
               S22235 : 0.95
               S1400 : 22.53
               angsize : 5.0
               location : J2000 @ (14:11:20.65, 52:12:09.14)
[21:41:43] Slewing to source.
[21:41:43] In state Activating, waiting for state Ready
[21:41:43]     Setting State: Ready
[21:41:43] Detected state Ready
[21:41:43] Balancing IF system.
[21:41:43] Balancing IFRack
[21:41:46] the sampler values are:
[21:41:50] RF_power 1 : 0.7714844
[21:41:50] RF_power 2 : 0
[21:41:50] RF_power 3 : 1.113281
[21:41:50] RF_power 4 : 0.01953125
[21:41:50] RF_power 5 : 0.0390625
[21:41:50] RF_power 6 : 1.206055
[21:41:50] RF_power 7 : 1.918945
[21:41:50] RF_power 8 : 0.02929688
[21:41:50] source : 3C295
               F1 : 0.4
               F2 : 32.0
               S22235 : 0.95
               S1400 : 22.53
               angsize : 5.0
               location : J2000 @ (14:11:20.65, 52:12:09.14)
[21:41:50] Peak: Subscan 1 of 4
[21:41:50]     Setting State: Activating
[21:41:51] In state Activating, waiting for state Running
[21:46:04]     Setting State: Committed
[21:46:06]     Setting State: Running
[21:46:06] Detected state Running
[21:46:06] *** Notice: This subscan will be numbered as scan #1 in your data reduction package.
[21:46:06] In state Running, waiting for state Ready
[21:46:36]     Setting State: Stopping
[21:46:41]     Setting State: Ready
[21:46:41] Detected state Ready
[21:46:41] Ygor Telescope: WaitForStopping
[21:46:41] Peak: Subscan 2 of 4
[21:46:41] In state Ready, waiting for state Running
[21:46:41]     Setting State: Activating
[21:46:49]     Setting State: Committed
[21:46:51]     Setting State: Running
[21:46:51] Detected state Running
[21:46:51] *** Notice: This subscan will be numbered as scan #2 in your data reduction package.
[21:46:51] In state Running, waiting for state Ready
[21:47:21]     Setting State: Stopping
[21:47:26]     Setting State: Ready
[21:47:26] Detected state Ready
[21:47:26] Ygor Telescope: WaitForStopping
[21:47:26] *** Updating antenna's pointing to az2=0.0628 and el=0.0000 arcmins

[21:47:26] Peak: Subscan 3 of 4
[21:47:27] In state Ready, waiting for state Running
[21:47:27]     Setting State: Activating
[21:47:45]     Setting State: Committed
[21:47:47]     Setting State: Running
[21:47:47] Detected state Running
[21:47:47] *** Notice: This subscan will be numbered as scan #3 in your data reduction package.
[21:47:47] In state Running, waiting for state Ready
[21:48:17]     Setting State: Stopping
[21:48:21]     Setting State: Ready
[21:48:21] Detected state Ready
[21:48:21] Ygor Telescope: WaitForStopping
[21:48:21] Peak: Subscan 4 of 4
[21:48:22] In state Ready, waiting for state Running
[21:48:22]     Setting State: Activating
[21:48:30]     Setting State: Committed
[21:48:32]     Setting State: Running
[21:48:32] Detected state Running
[21:48:32] *** Notice: This subscan will be numbered as scan #4 in your data reduction package.
[21:48:32] In state Running, waiting for state Ready
[21:49:02]     Setting State: Stopping
[21:49:07]     Setting State: Ready
[21:49:07] Detected state Ready
[21:49:07] Ygor Telescope: WaitForStopping
[21:49:07] *** Updating antenna's pointing to az2=0.0628 and el=0.0685 arcmins

[21:49:08] source : 3C295
               F1 : 0.4
               F2 : 32.0
               S22235 : 0.95
               S1400 : 22.53
               angsize : 5.0
               location : J2000 @ (14:11:20.65, 52:12:09.14)
[21:49:08] Focus: Subscan 1 of 1
[21:49:08] In state Ready, waiting for state Running
[21:49:08]     Setting State: Activating
[21:49:34]     Setting State: Committed
[21:49:36]     Setting State: Running
[21:49:36] Detected state Running
[21:49:36] *** Notice: This subscan will be numbered as scan #5 in your data reduction package.
[21:49:36] In state Running, waiting for state Ready
[21:50:36]     Setting State: Stopping
[21:50:38]     Setting State: Ready
[21:50:38] Detected state Ready
[21:50:38] Ygor Telescope: WaitForStopping
[21:50:39] . . . . . . . . . . . . . . . . . 
[21:50:55] 
[21:50:55] User queried: "No corrections detected! Wait longer?" waiting for reply...
[21:50:56] User replied: "Yes".
[21:50:57] . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
[21:51:52] 
[21:51:52] User queried: "No corrections! Terminate block?" waiting for reply...
[21:51:55] User replied: "No".
[21:51:56] Configuring telescope.
[21:51:57]     Setting State: Activating
[21:51:58]     Setting State: Ready
[21:52:00]     Setting State: Activating
[21:52:01]     Setting State: Ready
[21:52:01] Default values are
[21:52:01] if3freq  =  [0, 0, 0]
[21:52:01] notchfilter  =  In
[21:52:01] polswitch  =  thru
[21:52:01] The bad devices are: 
[21:52:01] OpticalDriver5
[21:52:01] The bad devices are: 
[21:52:01] OpticalDriver5
[21:52:01] WARNING: Frequencies adjusted to the local frame and velocities fall within the notch filter limits
[21:52:01] Frequency =  1345.0
[21:52:01] Frequency =  1345.0
[21:52:01] Frequency =  1345.0
[21:52:01] Frequency =  1345.0
[21:52:01] Waiting for the ConverterRack to finish activating
[21:52:01] . .
[21:52:01] Checking telescope
[21:52:01] Configuration Complete
[21:52:01] source : 3C295
               F1 : 0.4
               F2 : 32.0
               S22235 : 0.95
               S1400 : 22.53
               angsize : 5.0
               location : J2000 @ (14:11:20.65, 52:12:09.14)
[21:52:01] Slewing to source.
[21:52:01] In state Activating, waiting for state Ready
[21:52:28]     Setting State: Ready
[21:52:28] Detected state Ready
[21:52:28] Balancing IF system.
[21:52:29] Balancing IFRack
[21:52:29]     Setting State: Activating
[21:52:30]     Setting State: Ready
[21:52:31] the sampler values are:
[21:52:31] RF_power 1 : 2.915039
[21:52:31] RF_power 2 : 0.004882812
[21:52:31] RF_power 3 : 3.129883
[21:52:31] RF_power 4 : 0.01464844
[21:52:31] RF_power 5 : 0.0390625
[21:52:31] RF_power 6 : 2.714844
[21:52:31] RF_power 7 : 3.09082
[21:52:31] RF_power 8 : 0.02929688
[21:52:31] Balancing VEGAS
[21:52:31]     Setting State: Activating
[21:52:31]     Setting State: Ready
[21:52:32]     Setting State: Activating
[21:52:33]     Setting State: Ready
[21:52:34]     Setting State: Activating
[21:52:35]     Setting State: Ready
[21:52:36]     Setting State: Activating
[21:52:37]     Setting State: Ready
[21:52:38]     Setting State: Activating
[21:52:39] Calibration scans (OnOff) :3C295 
[21:52:39] source : 3C295
               F1 : 0.4
               F2 : 32.0
               S22235 : 0.95
               S1400 : 22.53
               angsize : 5.0
               location : J2000 @ (14:11:20.65, 52:12:09.14)
[21:52:39] OnOff: Subscan 1 of 2
[21:52:39]     Setting State: Ready
[21:52:39] In state Ready, waiting for state Running
[21:52:39]     Setting State: Activating
[21:52:44]     Setting State: Committed
[21:52:46]     Setting State: Running
[21:52:46] Detected state Running
[21:52:46] *** Notice: This subscan will be numbered as scan #6 in your data reduction package.
[21:52:46] In state Running, waiting for state Ready
[21:54:46]     Setting State: Stopping
[21:54:48]     Setting State: Ready
[21:54:48] Detected state Ready
[21:54:48] Ygor Telescope: WaitForStopping
[21:54:48] OnOff: Subscan 2 of 2
[21:54:48] In state Ready, waiting for state Running
[21:54:48]     Setting State: Activating
[21:55:01]     Setting State: Committed
[21:55:03]     Setting State: Running
[21:55:03] Detected state Running
[21:55:03] *** Notice: This subscan will be numbered as scan #7 in your data reduction package.
[21:55:03] In state Running, waiting for state Ready
[21:57:03]     Setting State: Stopping
[21:57:05]     Setting State: Ready
[21:57:05] Detected state Ready
[21:57:05] Ygor Telescope: WaitForStopping
[21:57:05] source : NGC6155
               N_OBS : 0.0
               SESSION : 25.0
               location : J2000 @ (16:26:08.30, 48:22:00.50)
               CALIBRATOR : 3C295
               VEL : 2400.2
[21:57:05] Slewing to source.
[21:57:05] In state Activating, waiting for state Ready
[21:58:13]     Setting State: Ready
[21:58:13] Detected state Ready
[21:58:13] Balancing IF system.
[21:58:13] Balancing IFRack
[21:58:14]     Setting State: Activating
[21:58:14]     Setting State: Ready
[21:58:15] the sampler values are:
[21:58:15] RF_power 1 : 2.587891
[21:58:15] RF_power 2 : 0
[21:58:15] RF_power 3 : 3.037109
[21:58:15] RF_power 4 : 0.01464844
[21:58:15] RF_power 5 : 0.0390625
[21:58:15] RF_power 6 : 2.910156
[21:58:15] RF_power 7 : 3.500977
[21:58:15] RF_power 8 : 0.02441406
[21:58:15] Balancing VEGAS
[21:58:15]     Setting State: Activating
[21:58:16]     Setting State: Ready
[21:58:16]     Setting State: Activating
[21:58:17]     Setting State: Ready
[21:58:18]     Setting State: Activating
[21:58:18]     Setting State: Ready
[21:58:18] Starting on-source scan
[21:58:18] source : NGC6155
               N_OBS : 0.0
               SESSION : 25.0
               location : J2000 @ (16:26:08.30, 48:22:00.50)
               CALIBRATOR : 3C295
               VEL : 2400.2
[21:58:18] Track: Subscan 1 of 1
[21:58:19] In state Ready, waiting for state Running
[21:58:19]     Setting State: Activating
[21:58:24]     Setting State: Committed
[21:58:26]     Setting State: Running
[21:58:26] Detected state Running
[21:58:26] *** Notice: This subscan will be numbered as scan #8 in your data reduction package.
[21:58:26] In state Running, waiting for state Ready
[22:05:26]     Setting State: Stopping
[22:05:28]     Setting State: Ready
[22:05:28] Detected state Ready
[22:05:28] Ygor Telescope: WaitForStopping
[22:05:28] Starting off-source scan
[22:05:28] source : NGC6155
               N_OBS : 0.0
               SESSION : 25.0
               location : J2000 @ (16:26:08.30, 48:22:00.50)
               CALIBRATOR : 3C295
               VEL : 2400.2
[22:05:28] Track: Subscan 1 of 1
[22:05:28] In state Ready, waiting for state Running
[22:05:29]     Setting State: Activating
[22:05:42]     Setting State: Committed
[22:05:44]     Setting State: Running
[22:05:44] Detected state Running
[22:05:44] *** Notice: This subscan will be numbered as scan #9 in your data reduction package.
[22:05:44] In state Running, waiting for state Ready
[22:12:44]     Setting State: Stopping
[22:12:46]     Setting State: Ready
[22:12:46] Detected state Ready
[22:12:46] Ygor Telescope: WaitForStopping
[22:12:46] Starting on-source scan
[22:12:46] source : NGC6155
               N_OBS : 0.0
               SESSION : 25.0
               location : J2000 @ (16:26:08.30, 48:22:00.50)
               CALIBRATOR : 3C295
               VEL : 2400.2
[22:12:46] Track: Subscan 1 of 1
[22:12:46] In state Ready, waiting for state Running
[22:12:47]     Setting State: Activating
[22:13:00]     Setting State: Committed
[22:13:02]     Setting State: Running
[22:13:02] Detected state Running
[22:13:02] *** Notice: This subscan will be numbered as scan #10 in your data reduction package.
[22:13:02] In state Running, waiting for state Ready
[22:20:02]     Setting State: Stopping
[22:20:04]     Setting State: Ready
[22:20:04] Detected state Ready
[22:20:04] Ygor Telescope: WaitForStopping
[22:20:04] NGC6155: OBS COMPLETE = 1/3
[22:20:04] Updating Catalogs
[22:20:04] Starting on-source scan
[22:20:04] source : NGC6155
               N_OBS : 0.0
               SESSION : 25.0
               location : J2000 @ (16:26:08.30, 48:22:00.50)
               CALIBRATOR : 3C295
               VEL : 2400.2
[22:20:04] Track: Subscan 1 of 1
[22:20:05] In state Ready, waiting for state Running
[22:20:05]     Setting State: Activating
[22:20:10]     Setting State: Committed
[22:20:12]     Setting State: Running
[22:20:12] Detected state Running
[22:20:12] *** Notice: This subscan will be numbered as scan #11 in your data reduction package.
[22:20:12] In state Running, waiting for state Ready
[22:27:12]     Setting State: Stopping
[22:27:14]     Setting State: Ready
[22:27:14] Detected state Ready
[22:27:14] Ygor Telescope: WaitForStopping
[22:27:14] Starting off-source scan
[22:27:14] source : NGC6155
               N_OBS : 0.0
               SESSION : 25.0
               location : J2000 @ (16:26:08.30, 48:22:00.50)
               CALIBRATOR : 3C295
               VEL : 2400.2
[22:27:14] Track: Subscan 1 of 1
[22:27:14] In state Ready, waiting for state Running
[22:27:15]     Setting State: Activating
[22:27:28]     Setting State: Committed
[22:27:30]     Setting State: Running
[22:27:30] Detected state Running
[22:27:30] *** Notice: This subscan will be numbered as scan #12 in your data reduction package.
[22:27:30] In state Running, waiting for state Ready
[22:34:30]     Setting State: Stopping
[22:34:32]     Setting State: Ready
[22:34:32] Detected state Ready
[22:34:32] Ygor Telescope: WaitForStopping
[22:34:32] Starting on-source scan
[22:34:32] source : NGC6155
               N_OBS : 0.0
               SESSION : 25.0
               location : J2000 @ (16:26:08.30, 48:22:00.50)
               CALIBRATOR : 3C295
               VEL : 2400.2
[22:34:32] Track: Subscan 1 of 1
[22:34:32] In state Ready, waiting for state Running
[22:34:33]     Setting State: Activating
[22:34:46]     Setting State: Committed
[22:34:48]     Setting State: Running
[22:34:48] Detected state Running
[22:34:48] *** Notice: This subscan will be numbered as scan #13 in your data reduction package.
[22:34:48] In state Running, waiting for state Ready
[22:41:48]     Setting State: Stopping
[22:41:50]     Setting State: Ready
[22:41:50] Detected state Ready
[22:41:50] Ygor Telescope: WaitForStopping
[22:41:50] NGC6155: OBS COMPLETE = 2/3
[22:41:50] Updating Catalogs
[22:41:50] Starting on-source scan
[22:41:50] source : NGC6155
               N_OBS : 0.0
               SESSION : 25.0
               location : J2000 @ (16:26:08.30, 48:22:00.50)
               CALIBRATOR : 3C295
               VEL : 2400.2
[22:41:50] Track: Subscan 1 of 1
[22:41:51] In state Ready, waiting for state Running
[22:41:51]     Setting State: Activating
[22:41:56]     Setting State: Committed
[22:41:58]     Setting State: Running
[22:41:58] Detected state Running
[22:41:58] *** Notice: This subscan will be numbered as scan #14 in your data reduction package.
[22:41:58] In state Running, waiting for state Ready
[22:48:58]     Setting State: Stopping
[22:49:00]     Setting State: Ready
[22:49:00] Detected state Ready
[22:49:00] Ygor Telescope: WaitForStopping
[22:49:00] Starting off-source scan
[22:49:00] source : NGC6155
               N_OBS : 0.0
               SESSION : 25.0
               location : J2000 @ (16:26:08.30, 48:22:00.50)
               CALIBRATOR : 3C295
               VEL : 2400.2
[22:49:00] Track: Subscan 1 of 1
[22:49:00] In state Ready, waiting for state Running
[22:49:01]     Setting State: Activating
[22:49:14]     Setting State: Committed
[22:49:16]     Setting State: Running
[22:49:16] Detected state Running
[22:49:16] *** Notice: This subscan will be numbered as scan #15 in your data reduction package.
[22:49:16] In state Running, waiting for state Ready
[22:56:16]     Setting State: Stopping
[22:56:18]     Setting State: Ready
[22:56:18] Detected state Ready
[22:56:18] Ygor Telescope: WaitForStopping
[22:56:18] Starting on-source scan
[22:56:18] source : NGC6155
               N_OBS : 0.0
               SESSION : 25.0
               location : J2000 @ (16:26:08.30, 48:22:00.50)
               CALIBRATOR : 3C295
               VEL : 2400.2
[22:56:18] Track: Subscan 1 of 1
[22:56:18] In state Ready, waiting for state Running
[22:56:19]     Setting State: Activating
[22:56:32]     Setting State: Committed
[22:56:34]     Setting State: Running
[22:56:34] Detected state Running
[22:56:34] *** Notice: This subscan will be numbered as scan #16 in your data reduction package.
[22:56:34] In state Running, waiting for state Ready
[23:03:34]     Setting State: Stopping
[23:03:36]     Setting State: Ready
[23:03:36] Detected state Ready
[23:03:36] Ygor Telescope: WaitForStopping
[23:03:36] NGC6155: OBS COMPLETE = 3/3
[23:03:36] Updating Catalogs
[23:03:36] source : NGC6310
               N_OBS : 0.0
               SESSION : 28.0
               location : J2000 @ (17:07:57.50, 60:59:24.60)
               CALIBRATOR : 3C295
               VEL : 3370.9
[23:03:36] Slewing to source.
[23:03:36] In state Activating, waiting for state Ready
[23:04:23]     Setting State: Ready
[23:04:23] Detected state Ready
[23:04:23] Balancing IF system.
[23:04:23] Balancing IFRack
[23:04:23]     Setting State: Activating
[23:04:24]     Setting State: Ready
[23:04:25] the sampler values are:
[23:04:25] RF_power 1 : 2.768555
[23:04:25] RF_power 2 : 0.004882812
[23:04:25] RF_power 3 : 2.802734
[23:04:25] RF_power 4 : 0.01953125
[23:04:25] RF_power 5 : 0.0390625
[23:04:25] RF_power 6 : 2.592773
[23:04:25] RF_power 7 : 2.397461
[23:04:25] RF_power 8 : 0.02441406
[23:04:25] Balancing VEGAS
[23:04:25]     Setting State: Activating
[23:04:25]     Setting State: Ready
[23:04:26]     Setting State: Activating
[23:04:27]     Setting State: Ready
[23:04:27] Starting on-source scan
[23:04:27] source : NGC6310
               N_OBS : 0.0
               SESSION : 28.0
               location : J2000 @ (17:07:57.50, 60:59:24.60)
               CALIBRATOR : 3C295
               VEL : 3370.9
[23:04:27] Track: Subscan 1 of 1
[23:04:28] In state Ready, waiting for state Running
[23:04:28]     Setting State: Activating
[23:04:33]     Setting State: Committed
[23:04:35]     Setting State: Running
[23:04:35] Detected state Running
[23:04:35] *** Notice: This subscan will be numbered as scan #17 in your data reduction package.
[23:04:35] In state Running, waiting for state Ready
[23:11:35]     Setting State: Stopping
[23:11:37]     Setting State: Ready
[23:11:37] Detected state Ready
[23:11:37] Ygor Telescope: WaitForStopping
[23:11:37] Starting off-source scan
[23:11:37] source : NGC6310
               N_OBS : 0.0
               SESSION : 28.0
               location : J2000 @ (17:07:57.50, 60:59:24.60)
               CALIBRATOR : 3C295
               VEL : 3370.9
[23:11:37] Track: Subscan 1 of 1
[23:11:37] In state Ready, waiting for state Running
[23:11:38]     Setting State: Activating
[23:11:51]     Setting State: Committed
[23:11:53]     Setting State: Running
[23:11:53] Detected state Running
[23:11:53] *** Notice: This subscan will be numbered as scan #18 in your data reduction package.
[23:11:53] In state Running, waiting for state Ready
[23:18:53]     Setting State: Stopping
[23:18:55]     Setting State: Ready
[23:18:55] Detected state Ready
[23:18:55] Ygor Telescope: WaitForStopping
[23:18:55] Starting on-source scan
[23:18:55] source : NGC6310
               N_OBS : 0.0
               SESSION : 28.0
               location : J2000 @ (17:07:57.50, 60:59:24.60)
               CALIBRATOR : 3C295
               VEL : 3370.9
[23:18:55] Track: Subscan 1 of 1
[23:18:55] In state Ready, waiting for state Running
[23:18:56]     Setting State: Activating
[23:19:09]     Setting State: Committed
[23:19:11]     Setting State: Running
[23:19:11] Detected state Running
[23:19:11] *** Notice: This subscan will be numbered as scan #19 in your data reduction package.
[23:19:11] In state Running, waiting for state Ready
[23:26:11]     Setting State: Stopping
[23:26:13]     Setting State: Ready
[23:26:13] Detected state Ready
[23:26:13] Ygor Telescope: WaitForStopping
[23:26:13] NGC6310: OBS COMPLETE = 1/3
[23:26:13] Updating Catalogs
[23:26:13] Starting on-source scan
[23:26:13] source : NGC6310
               N_OBS : 0.0
               SESSION : 28.0
               location : J2000 @ (17:07:57.50, 60:59:24.60)
               CALIBRATOR : 3C295
               VEL : 3370.9
[23:26:13] Track: Subscan 1 of 1
[23:26:14] In state Ready, waiting for state Running
[23:26:14]     Setting State: Activating
[23:26:19]     Setting State: Committed
[23:26:21]     Setting State: Running
[23:26:21] Detected state Running
[23:26:21] *** Notice: This subscan will be numbered as scan #20 in your data reduction package.
[23:26:21] In state Running, waiting for state Ready
[23:33:21]     Setting State: Stopping
[23:33:23]     Setting State: Ready
[23:33:23] Detected state Ready
[23:33:23] Ygor Telescope: WaitForStopping
[23:33:23] Starting off-source scan
[23:33:23] source : NGC6310
               N_OBS : 0.0
               SESSION : 28.0
               location : J2000 @ (17:07:57.50, 60:59:24.60)
               CALIBRATOR : 3C295
               VEL : 3370.9
[23:33:23] Track: Subscan 1 of 1
[23:33:23] In state Ready, waiting for state Running
[23:33:24]     Setting State: Activating
[23:33:37]     Setting State: Committed
[23:33:39]     Setting State: Running
[23:33:39] Detected state Running
[23:33:39] *** Notice: This subscan will be numbered as scan #21 in your data reduction package.
[23:33:39] In state Running, waiting for state Ready
[23:40:39]     Setting State: Stopping
[23:40:41]     Setting State: Ready
[23:40:41] Detected state Ready
[23:40:41] Ygor Telescope: WaitForStopping
[23:40:41] Starting on-source scan
[23:40:41] source : NGC6310
               N_OBS : 0.0
               SESSION : 28.0
               location : J2000 @ (17:07:57.50, 60:59:24.60)
               CALIBRATOR : 3C295
               VEL : 3370.9
[23:40:41] Track: Subscan 1 of 1
[23:40:41] In state Ready, waiting for state Running
[23:40:42]     Setting State: Activating
[23:40:55]     Setting State: Committed
[23:40:57]     Setting State: Running
[23:40:57] Detected state Running
[23:40:57] *** Notice: This subscan will be numbered as scan #22 in your data reduction package.
[23:40:57] In state Running, waiting for state Ready
[23:47:57]     Setting State: Stopping
[23:47:59]     Setting State: Ready
[23:47:59] Detected state Ready
[23:47:59] Ygor Telescope: WaitForStopping
[23:47:59] NGC6310: OBS COMPLETE = 2/3
[23:47:59] Updating Catalogs
[23:47:59] Starting on-source scan
[23:47:59] source : NGC6310
               N_OBS : 0.0
               SESSION : 28.0
               location : J2000 @ (17:07:57.50, 60:59:24.60)
               CALIBRATOR : 3C295
               VEL : 3370.9
[23:47:59] Track: Subscan 1 of 1
[23:48:00] In state Ready, waiting for state Running
[23:48:00]     Setting State: Activating
[23:48:05]     Setting State: Committed
[23:48:07]     Setting State: Running
[23:48:07] Detected state Running
[23:48:07] *** Notice: This subscan will be numbered as scan #23 in your data reduction package.
[23:48:07] In state Running, waiting for state Ready
[23:55:07]     Setting State: Stopping
[23:55:09]     Setting State: Ready
[23:55:09] Detected state Ready
[23:55:09] Ygor Telescope: WaitForStopping
[23:55:09] Starting off-source scan
[23:55:09] source : NGC6310
               N_OBS : 0.0
               SESSION : 28.0
               location : J2000 @ (17:07:57.50, 60:59:24.60)
               CALIBRATOR : 3C295
               VEL : 3370.9
[23:55:09] Track: Subscan 1 of 1
[23:55:09] In state Ready, waiting for state Running
[23:55:10]     Setting State: Activating
[23:55:23]     Setting State: Committed
[23:55:25]     Setting State: Running
[23:55:25] Detected state Running
[23:55:25] *** Notice: This subscan will be numbered as scan #24 in your data reduction package.
[23:55:25] In state Running, waiting for state Ready
[00:02:25]     Setting State: Stopping
[00:02:27]     Setting State: Ready
[00:02:27] Detected state Ready
[00:02:27] Ygor Telescope: WaitForStopping
[00:02:27] Starting on-source scan
[00:02:27] source : NGC6310
               N_OBS : 0.0
               SESSION : 28.0
               location : J2000 @ (17:07:57.50, 60:59:24.60)
               CALIBRATOR : 3C295
               VEL : 3370.9
[00:02:27] Track: Subscan 1 of 1
[00:02:27] In state Ready, waiting for state Running
[00:02:28]     Setting State: Activating
[00:02:41]     Setting State: Committed
[00:02:43]     Setting State: Running
[00:02:43] Detected state Running
[00:02:43] *** Notice: This subscan will be numbered as scan #25 in your data reduction package.
[00:02:43] In state Running, waiting for state Ready
[00:09:43]     Setting State: Stopping
[00:09:45]     Setting State: Ready
[00:09:45] Detected state Ready
[00:09:45] Ygor Telescope: WaitForStopping
[00:09:45] NGC6310: OBS COMPLETE = 3/3
[00:09:45] Updating Catalogs


[00:09:45] <type 'exceptions.NameError'> name 'altCal' is not defined
[00:09:45]   File "/home/sparrow/14.4/lib/python/gbt/turtle/proc/Scheduler.py", line 262, in RunObservation
[00:09:45]     observation.Execute(self.GetUserTelescope())
[00:09:45]   File "/home/sparrow/14.4/lib/python/gbt/turtle/proc/Observation.py", line 143, in Execute
[00:09:45]     exec self.GetScript() in self.DefineLocals(telescope)
[00:09:45]   File "<string>", line 78, in <module>
runSuccessful: False
[00:09:45] ******** End Scheduling Block
[00:09:45] ******** observer = OPERATOR, SB name = 15B287_operator_test, project ID = AGBT15B_287

how much log? 26433 id: 177512self.history: <gbt.turtle.database.History.History instance at 0x51cfa70>self.history.connection: <gbt.turtle.database.TurtleConnection.TurtleConnection instance at 0x51cd710>how much converted log? 26647 
#######################################################
 
 
#######################################################
 SCRIPT NUMBER 2, project:AGBT15B_287_08 
 177513 128 OPERATOR 9 Rob Whalen 2015-12-02 00:10:27 obs_aborted 
#######################################################
# test script to update catalog as you go...

########## CHANGE THESE ONLY #############
OnOffOnTime = 21 #minutes (change this to 12 to be in line with DSS scheduling)
obs_per_source = 3 #total observing time per source = OnOffOnTime * obs_per_source
h = Horizon(10.0) #minimum of 10 degrees elevation
myOff = Offset("J2000",1.0,0.0,cosv=True)  # Off position relative to source
doFirstPointing = True #Setting to False will skip the first pointing
doFirstCal = True  #Setting to False will skip the first 3C calibrator OnOff scan
peak_every = 6 #peak/cal every 6 OnOffOn (every 2.5 hours) 12 if changed
peak_near_source = False #Do another peak when changing to new source
#####################################

######### NOTES ###############
# This script runs in blocks of On-Off-On position switching with
# the two outer 'on' scans sharing one 'off'
# Total on-source time = 42 minutes   (24 if changes)
# Length of one 'On' or 'Off' = 7 minutes   (4 minutes if changes)
# Length of one On-Off-On = 21 minutes (14 minutes on-source)    (12 min if changes)
# 3 On-Off-On blocks are needed per source (63 minutes altogether)  (36 minutes if changes)
# !!!! Please remember to update catalog after session is complete

###### Timing
# It takes 1h 8m to completely observe 1 source+overhead (9 track scans)

execfile("/home/astro-util/projects/15B287_operator/15B287_config.py")
execfile("/home/astro-util/projects/15B287_operator/15B287_utils.py")
Catalog(fluxcal)
Catalog(lband_pointing)

scanTime = OnOffOnTime * 20.0 #seconds
tdelta = DateTime.TimeDelta(minutes=OnOffOnTime)
obs_count = 0
doCal = doFirstCal
doPointing = doFirstPointing
project_obs = 0
old_catalog_name = 'dummy'
fullcat = '/home/astro-util/projects/15B287_operator/15B287_operator.cat'

Configure(config_1)

while project_obs < 10:
    mycat,altcal = select_my_catalog()
    if mycat == old_catalog_name:
        print 'SAME CATALOG HAS BEEN SELECTED: Using FULL catalog'
        mycat = fullcat
        altcal = '3C309_1'
    old_catalog_name = mycat
    c = Catalog(mycat)
    sources = c.keys()
    for source in sources:
        doBalance = True
        newPeak = True
        calibrator = c[source]["calibrator"]
        n_obs = int(float(c[source]["n_obs"]))
        obs_left = obs_per_source-n_obs
        obs_ok = obs_left > 0
        t_now = Now()
        if t_now != None and obs_ok:
            source_rise = h.GetRise(source)
            source_set  = h.GetSet(source)
            if source_rise != None:
                if source_set != None:
                    t_ok = ((t_now + tdelta) < source_set)
                    t_ok = t_ok and (t_now >= source_rise)
                else:
                    t_ok = True
            else:
                t_ok = False
        else:
            t_ok = False

        source_ok = t_ok and obs_ok

        if source_ok:
            if doPointing == True:
                #check the calibrator is above the horizon
                if h.GetRise(calibrator)>t_now:
                    myCal = altCal #circumpolar alternative
                    print 'Calibrator %s is too low: Using %s' %(calibrator,altCal)
                else:
                    myCal = calibrator
                if obs_count == 0:
                    AutoPeakFocus(myCal)
                    #Break("Check Peak and Focus")
                else:
                    AutoPeak(myCal)
                Configure(config_1)
                doBalance = True
                doPointing = False

            if doCal:
                Slew(myCal)
                Balance()
                print 'Calibration scans (OnOff) :%s ' %(myCal)
                OnOff(myCal,myOff,120.0)
                doCal = False
                doBalance = True

            for i in range(obs_left):
                t_now = Now()   #check time ok again
                t_ok = False
                if t_now != None:
                    if source_rise != None:
                        if source_set != None:
                            t_ok = ((t_now + tdelta) < source_set)
                            t_ok = t_ok and (t_now >= source_rise)
                        else:
                            t_ok = True
                    else:
                        t_ok = False
                else:
                    t_ok = False

                if t_ok:
                    if peak_near_source and newPeak:
                        Slew(source)
                        AutoPeak()
                        Configure(config_1)
                        newPeak = False
                        doBalance = True
                    if doBalance:
                        Slew(source)
                        Balance()
                        doBalance = False

                    Comment("Starting on-source scan")
                    Track(source,None,scanTime)
                    Comment("Starting off-source scan")
                    Track(source,None,scanTime,fixedOffset=myOff)
                    Comment("Starting on-source scan")
                    Track(source,None,scanTime)
                    obs_count = obs_count + 1
                    obs_tot = obs_per_source+1-obs_left+i
                    print '%s: OBS COMPLETE = %s/%s' %(source,obs_tot,obs_per_source)
                    update_my_catalogs(source,obs_tot)

                    if obs_count % peak_every == 0:  #Cal/pointing interval
                        doCal = True
                        doPointing = True
        if source_ok and mycat == fullcat:
            break
    project_obs = project_obs+1
#######################################################
 LOG SESSION NUMBER 2 
[00:10:27] ******** Begin Scheduling Block
[00:10:27] ******** observer = OPERATOR, SB name = 15B287_operator, project ID = AGBT15B_287, date = 02 Dec 2015

[00:10:27] Configuring telescope.
[00:10:27]     Setting State: Activating
[00:10:28]     Setting State: Ready
[00:10:29]     Setting State: Activating
[00:10:29]     Setting State: Ready
[00:10:29] Default values are
[00:10:29] if3freq  =  [0, 0, 0]
[00:10:29] notchfilter  =  In
[00:10:29] polswitch  =  thru
[00:10:29] The bad devices are: 
[00:10:29] OpticalDriver5
[00:10:29] The bad devices are: 
[00:10:29] OpticalDriver5
[00:10:29] WARNING: Frequencies adjusted to the local frame and velocities fall within the notch filter limits
[00:10:29] Frequency =  1345.0
[00:10:29] Frequency =  1345.0
[00:10:29] Frequency =  1345.0
[00:10:29] Frequency =  1345.0

[00:10:29] Checking telescope
[00:10:29] Configuration Complete
[00:10:29] Selecting Catalog
[00:10:29] Using Catalog for LST 17-21


[00:10:29] <type 'exceptions.NameError'> name 'altCal' is not defined
[00:10:29]   File "/home/sparrow/14.4/lib/python/gbt/turtle/proc/Scheduler.py", line 262, in RunObservation
[00:10:29]     observation.Execute(self.GetUserTelescope())
[00:10:29]   File "/home/sparrow/14.4/lib/python/gbt/turtle/proc/Observation.py", line 143, in Execute
[00:10:29]     exec self.GetScript() in self.DefineLocals(telescope)
[00:10:29]   File "<string>", line 79, in <module>
runSuccessful: False
[00:10:29] ******** End Scheduling Block
[00:10:29] ******** observer = OPERATOR, SB name = 15B287_operator, project ID = AGBT15B_287

how much log? 1573 id: 177513self.history: <gbt.turtle.database.History.History instance at 0x51cfa70>self.history.connection: <gbt.turtle.database.TurtleConnection.TurtleConnection instance at 0x51cd710>how much converted log? 1781 
#######################################################
 
 
#######################################################
 SCRIPT NUMBER 3, project:AGBT15B_287_08 
 177514 128 OPERATOR 9 Rob Whalen 2015-12-02 00:10:52 obs_aborted 
#######################################################
from mx import DateTime
execfile("/home/astro-util/projects/15B287_operator/15B287_config.py")
Catalog(fluxcal)
Catalog(lband_pointing)

########## CHANGE THESE ONLY #############
OnOffOnTime = 21 #minutes (change this to 12 to be in line with DSS scheduling)
obs_per_source = 3 #total observing time per source = OnOffOnTime * obs_per_source
h = Horizon(10.0) #minimum of 10 degrees elevation
myOff = Offset("J2000",1.0,0.0,cosv=True)  # Off position relative to source
doFirstPointing = True #Setting to False will skip the first pointing
doFirstCal = True  #Setting to False will skip the first 3C calibrator OnOff scan
peak_every = 6 #peak/cal every 6 OnOffOn (every 2.5 hours) 12 if changed
peak_near_source = True #Do another peak when changing to new source
#####################################


######### NOTES ###############
# This script runs in blocks of On-Off-On position switching with
# the two outer 'on' scans sharing one 'off'
# Total on-source time = 42 minutes   (24 if changes)
# Length of one 'On' or 'Off' = 7 minutes   (4 minutes if changes)
# Length of one On-Off-On = 21 minutes (14 minutes on-source)    (12 min if changes)
# 3 On-Off-On blocks are needed per source (63 minutes altogether)  (36 minutes if changes)
# !!!! Please remember to update catalog after session is complete

###### Timing
# It takes 1h 8m to completely observe 1 source+overhead (9 track scans)

LST = GetLST()
if LST >= 5 and LST <= 9:
    altCal = "3C249_1"
elif LST > 9 and LST <= 13:
    altCal = "3C249_1"
elif LST > 13 and LST <= 17:
    altCal = "3C309_1"
elif LST > 17 or LST < 5: #and LST <= 21:   #21 nominally
    altCal = "3C309_1"
c = Catalog("/home/astro-util/projects/15B287_operator/15B287_operator.cat")

sources = c.keys()
scanTime = OnOffOnTime * 20.0 #seconds
tdelta = DateTime.TimeDelta(minutes=OnOffOnTime)
obs_count = 0
doCal = doFirstCal
doPointing = doFirstPointing

Configure(config_1)

for source in sources:
    #print source
    doBalance = True
    newPeak = True
    calibrator = c[source]["calibrator"]
    n_obs = int(float(c[source]["n_obs"]))
    obs_left = obs_per_source-n_obs

    obs_ok = obs_left > 0
    t_now = Now()
    if t_now != None and obs_ok:
        source_rise = h.GetRise(source)
        source_set  = h.GetSet(source)
        if source_rise != None:
            if source_set != None:
                t_ok = ((t_now + tdelta) < source_set)
                t_ok = t_ok and (t_now >= source_rise)
            else:
                t_ok = True
        else:
            t_ok = False
    else:
        t_ok = False

    source_ok = t_ok and obs_ok

    if source_ok:
        if doPointing == True:
            #check the calibrator is above the horizon
            if h.GetRise(calibrator)>t_now:
                myCal = altCal #circumpolar alternative
                print 'Calibrator %s is too low: Using %s' %(calibrator,altCal)
            else:
                myCal = calibrator
            if obs_count == 0:
                AutoPeakFocus(myCal)
                #Break("Check Peak and Focus")
            else:
                AutoPeak(myCal)
            Configure(config_1)
            doBalance = True
            doPointing = False

        if doCal:
            Slew(myCal)
            Balance()
            print 'Calibration scans (OnOff) :%s ' %(myCal)
            OnOff(myCal,myOff,120.0)
            doCal = False
            doBalance = True

        for i in range(obs_left):
            t_now = Now()   #check time ok again
            t_ok = False
            if t_now != None:
                if source_rise != None:
                    if source_set != None:
                        t_ok = ((t_now + tdelta) < source_set)
                        t_ok = t_ok and (t_now >= source_rise)
                    else:
                        t_ok = True
                else:
                    t_ok = False
            else:
                t_ok = False

            if t_ok:
                if peak_near_source and newPeak:
                    AutoPeak()
                    Configure(config_1)
                    newPeak = False
                    doBalance = True
                if doBalance:
                    Slew(source)
                    Balance()
                    doBalance = False

                Comment("Starting on-source scan")
                Track(source,None,scanTime)
                Comment("Starting off-source scan")
                Track(source,None,scanTime,fixedOffset=myOff)
                Comment("Starting on-source scan")
                Track(source,None,scanTime)
                obs_count = obs_count + 1
                obs_tot = obs_per_source+1-obs_left+i
                print '%s: OBS COMPLETE = %s/%s' %(source,obs_tot,obs_per_source)
                if obs_count % peak_every == 0:  #Cal/pointing interval
                    doCal = True
                    doPointing = True

#######################################################
 LOG SESSION NUMBER 3 
[00:10:52] ******** Begin Scheduling Block
[00:10:52] ******** observer = OPERATOR, SB name = 15B287_operator_backup, project ID = AGBT15B_287, date = 02 Dec 2015

[00:10:53] Configuring telescope.
[00:10:53]     Setting State: Activating
[00:10:54]     Setting State: Ready
[00:10:56]     Setting State: Activating
[00:10:57]     Setting State: Ready
[00:10:57] Default values are
[00:10:57] if3freq  =  [0, 0, 0]
[00:10:57] notchfilter  =  In
[00:10:57] polswitch  =  thru
[00:10:57] The bad devices are: 
[00:10:57] OpticalDriver5
[00:10:57] The bad devices are: 
[00:10:57] OpticalDriver5
[00:10:57] WARNING: Frequencies adjusted to the local frame and velocities fall within the notch filter limits
[00:10:57] Frequency =  1345.0
[00:10:57] Frequency =  1345.0
[00:10:57] Frequency =  1345.0
[00:10:57] Frequency =  1345.0
[00:10:57] Waiting for the ConverterRack to finish activating
[00:10:57] . .
[00:10:57] Checking telescope
[00:10:57] Configuration Complete
[00:10:58] Configuring telescope.
[00:10:58]     Setting State: Activating
[00:11:00]     Setting State: Ready
[00:11:01]     Setting State: Activating
[00:11:02]     Setting State: Ready
[00:11:02] Default values are
[00:11:02] if3freq  =  [0]
[00:11:02] notchfilter  =  In
[00:11:02] polswitch  =  thru
[00:11:02] The bad devices are: 
[00:11:02] OpticalDriver5
[00:11:02] Waiting for the LO1 to finish activating
[00:11:02] . .
[00:11:02] Checking telescope
[00:11:02] Configuration Complete
[00:11:03] source : 3C147
               F1 : 0.4
               F2 : 23.8
               S22235 : 2.05
               S1400 : 22.42
               angsize : 1.0
               location : J2000 @ (05:42:36.14, 49:51:07.23)
[00:11:03] Slewing to source.
[00:11:03] In state Activating, waiting for state Ready
[00:11:27]     Setting State: Aborting
[00:11:27] ygor.Telescope: WaitForReady: Asking abort confirmation.
[00:11:27] 
[00:11:27] User queried: "Abort detected! Terminate block?" waiting for reply...
[00:11:28] User replied: "Yes".
[00:11:28] Exiting scheduling block.[00:11:28]     Setting State: Ready

runSuccessful: False
[00:11:28] ******** End Scheduling Block
[00:11:28] ******** observer = OPERATOR, SB name = 15B287_operator_backup, project ID = AGBT15B_287

how much log? 2242 id: 177514self.history: <gbt.turtle.database.History.History instance at 0x51cfa70>self.history.connection: <gbt.turtle.database.TurtleConnection.TurtleConnection instance at 0x51cd710>how much converted log? 2446 
#######################################################
 
 
#######################################################
 SCRIPT NUMBER 4, project:AGBT15B_287_08 
 177515 128 OPERATOR 9 Rob Whalen 2015-12-02 00:11:33 obs_aborted 
#######################################################
# test script to update catalog as you go...

########## CHANGE THESE ONLY #############
OnOffOnTime = 21 #minutes (change this to 12 to be in line with DSS scheduling)
obs_per_source = 3 #total observing time per source = OnOffOnTime * obs_per_source
h = Horizon(10.0) #minimum of 10 degrees elevation
myOff = Offset("J2000",1.0,0.0,cosv=True)  # Off position relative to source
doFirstPointing = True #Setting to False will skip the first pointing
doFirstCal = True  #Setting to False will skip the first 3C calibrator OnOff scan
peak_every = 6 #peak/cal every 6 OnOffOn (every 2.5 hours) 12 if changed
peak_near_source = False #Do another peak when changing to new source
#####################################

######### NOTES ###############
# This script runs in blocks of On-Off-On position switching with
# the two outer 'on' scans sharing one 'off'
# Total on-source time = 42 minutes   (24 if changes)
# Length of one 'On' or 'Off' = 7 minutes   (4 minutes if changes)
# Length of one On-Off-On = 21 minutes (14 minutes on-source)    (12 min if changes)
# 3 On-Off-On blocks are needed per source (63 minutes altogether)  (36 minutes if changes)
# !!!! Please remember to update catalog after session is complete

###### Timing
# It takes 1h 8m to completely observe 1 source+overhead (9 track scans)

execfile("/home/astro-util/projects/15B287_operator/15B287_config.py")
execfile("/home/astro-util/projects/15B287_operator/15B287_utils.py")
Catalog(fluxcal)
Catalog(lband_pointing)

scanTime = OnOffOnTime * 20.0 #seconds
tdelta = DateTime.TimeDelta(minutes=OnOffOnTime)
obs_count = 0
doCal = doFirstCal
doPointing = doFirstPointing
project_obs = 0
old_catalog_name = 'dummy'
fullcat = '/home/astro-util/projects/15B287_operator/15B287_operator.cat'

Configure(config_1)

while project_obs < 10:
    mycat,altcal = select_my_catalog()
    if mycat == old_catalog_name:
        print 'SAME CATALOG HAS BEEN SELECTED: Using FULL catalog'
        mycat = fullcat
        altcal = '3C309_1'
    old_catalog_name = mycat
    c = Catalog(mycat)
    sources = c.keys()
    for source in sources:
        doBalance = True
        newPeak = True
        calibrator = c[source]["calibrator"]
        n_obs = int(float(c[source]["n_obs"]))
        obs_left = obs_per_source-n_obs
        obs_ok = obs_left > 0
        t_now = Now()
        if t_now != None and obs_ok:
            source_rise = h.GetRise(source)
            source_set  = h.GetSet(source)
            if source_rise != None:
                if source_set != None:
                    t_ok = ((t_now + tdelta) < source_set)
                    t_ok = t_ok and (t_now >= source_rise)
                else:
                    t_ok = True
            else:
                t_ok = False
        else:
            t_ok = False

        source_ok = t_ok and obs_ok

        if source_ok:
            if doPointing == True:
                #check the calibrator is above the horizon
                if h.GetRise(calibrator)>t_now:
                    myCal = altCal #circumpolar alternative
                    print 'Calibrator %s is too low: Using %s' %(calibrator,altCal)
                else:
                    myCal = calibrator
                if obs_count == 0:
                    AutoPeakFocus(myCal)
                    #Break("Check Peak and Focus")
                else:
                    AutoPeak(myCal)
                Configure(config_1)
                doBalance = True
                doPointing = False

            if doCal:
                Slew(myCal)
                Balance()
                print 'Calibration scans (OnOff) :%s ' %(myCal)
                OnOff(myCal,myOff,120.0)
                doCal = False
                doBalance = True

            for i in range(obs_left):
                t_now = Now()   #check time ok again
                t_ok = False
                if t_now != None:
                    if source_rise != None:
                        if source_set != None:
                            t_ok = ((t_now + tdelta) < source_set)
                            t_ok = t_ok and (t_now >= source_rise)
                        else:
                            t_ok = True
                    else:
                        t_ok = False
                else:
                    t_ok = False

                if t_ok:
                    if peak_near_source and newPeak:
                        Slew(source)
                        AutoPeak()
                        Configure(config_1)
                        newPeak = False
                        doBalance = True
                    if doBalance:
                        Slew(source)
                        Balance()
                        doBalance = False

                    Comment("Starting on-source scan")
                    Track(source,None,scanTime)
                    Comment("Starting off-source scan")
                    Track(source,None,scanTime,fixedOffset=myOff)
                    Comment("Starting on-source scan")
                    Track(source,None,scanTime)
                    obs_count = obs_count + 1
                    obs_tot = obs_per_source+1-obs_left+i
                    print '%s: OBS COMPLETE = %s/%s' %(source,obs_tot,obs_per_source)
                    update_my_catalogs(source,obs_tot)

                    if obs_count % peak_every == 0:  #Cal/pointing interval
                        doCal = True
                        doPointing = True
        if source_ok and mycat == fullcat:
            break
    project_obs = project_obs+1
#######################################################
 LOG SESSION NUMBER 4 
[00:11:33] ******** Begin Scheduling Block
[00:11:33] ******** observer = OPERATOR, SB name = 15B287_operator_test, project ID = AGBT15B_287, date = 02 Dec 2015

[00:11:33] Configuring telescope.
[00:11:34]     Setting State: Activating
[00:11:35]     Setting State: Ready
[00:11:37]     Setting State: Activating
[00:11:38]     Setting State: Ready
[00:11:38] Default values are
[00:11:38] if3freq  =  [0, 0, 0]
[00:11:38] notchfilter  =  In
[00:11:38] polswitch  =  thru
[00:11:38] Error: Executing database query, trying again
[00:11:38] The bad devices are: 
[00:11:38] OpticalDriver5
[00:11:38] The bad devices are: 
[00:11:38] OpticalDriver5
[00:11:38] WARNING: Frequencies adjusted to the local frame and velocities fall within the notch filter limits
[00:11:38] Frequency =  1345.0
[00:11:38] Frequency =  1345.0
[00:11:38] Frequency =  1345.0
[00:11:38] Frequency =  1345.0
[00:11:38] Waiting for the ConverterRack to finish activating
[00:11:38] . .
[00:11:38] Checking telescope
[00:11:38] Configuration Complete
[00:11:38] Selecting Catalog
[00:11:38] Using Catalog for LST 17-21
[00:11:38] Calibrator 3C295 is too low: Using 3C309_1
[00:11:39] Configuring telescope.
[00:11:39]     Setting State: Activating
[00:11:40]     Setting State: Ready
[00:11:41]     Setting State: Activating
[00:11:41]     Setting State: Ready
[00:11:41] Default values are
[00:11:41] if3freq  =  [0]
[00:11:41] notchfilter  =  In
[00:11:41] polswitch  =  thru
[00:11:41] Error: Executing database query, trying again
[00:11:41] The bad devices are: 
[00:11:41] OpticalDriver5

[00:11:41] Checking telescope
[00:11:41] Configuration Complete
[00:11:41] source : 3C309_1
               F1 : 1.4
               F2 : 32.0
               S22235 : 1.0
               S1400 : 7.5
               angsize : 1.5
               location : J2000 @ (14:59:07.58, 71:40:19.87)
[00:11:41] Slewing to source.
[00:11:42] In state Activating, waiting for state Ready
[00:11:43]     Setting State: Aborting
[00:11:43] ygor.Telescope: WaitForReady: Asking abort confirmation.
[00:11:43] 
[00:11:43] User queried: "Abort detected! Terminate block?" waiting for reply...
[00:11:45] User replied: "Yes".
[00:11:45] Exiting scheduling block.
[00:11:45]     Setting State: Ready
runSuccessful: False
[00:11:45] ******** End Scheduling Block
[00:11:45] ******** observer = OPERATOR, SB name = 15B287_operator_test, project ID = AGBT15B_287

how much log? 2407 id: 177515self.history: <gbt.turtle.database.History.History instance at 0x51cfa70>self.history.connection: <gbt.turtle.database.TurtleConnection.TurtleConnection instance at 0x51cd710>how much converted log? 2611 
#######################################################
